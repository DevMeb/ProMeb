import{p as $,e as S,x as j,q as V,s as L,C as O,c as a,a as d,b as s,w as P,g as R,t as f,k as b,f as v,v as g,n as E,u as o}from"./app-D1nYlzh5.js";const G=$("clients",()=>{const u=S([]),p=S({}),k=S({});function C(e){e?p.value[e]=null:p.value={}}function _(e,r){k.value[e]=r}async function m({operation:e,request:r,onSuccess:l}){var y,t,w;C(e),_(e,!0);try{const c=await r();return l&&l(c),c}catch(c){((y=c.response)==null?void 0:y.status)===422?p.value.validationErrors=c.response.data.errors:(p.value[e]=((w=(t=c.response)==null?void 0:t.data)==null?void 0:w.message)||"Une erreur est survenue.",j("error",p.value[e]))}finally{_(e,!1)}}async function U(){return m({operation:"fetch",request:()=>V.get("/api/clients"),onSuccess:e=>{u.value=e.data.clients}})}async function h(e){return m({operation:"add",request:()=>V.post("/api/clients",e),onSuccess:r=>{u.value.push(r.data.client),j("success",r.data.message)}})}async function n(e){return m({operation:"update",request:()=>V.put(`/api/clients/${e.id}`,e),onSuccess:r=>{const l=u.value.findIndex(y=>y.id===e.id);l!==-1&&(u.value[l]=r.data.client),j("success",r.data.message)}})}async function x(e){return m({operation:"delete",request:()=>V.delete(`/api/clients/${e}`),onSuccess:r=>{u.value=u.value.filter(l=>l.id!==e),j("success",r.data.message)}})}return{clients:u,errors:p,loading:k,fetchClients:U,addClient:h,updateClient:n,deleteClient:x,clearErrors:C}}),H={class:"fixed inset-0 flex items-center justify-center bg-black/50 backdrop-blur-md z-50"},J={class:"bg-white p-6 rounded-xl shadow-xl w-[90%] sm:w-96 transform transition-all animate-fade-in"},K={class:"flex items-center justify-between border-b pb-2"},Q={class:"text-xl font-semibold text-gray-800 flex items-center"},W={key:0,class:"mr-2"},X={key:1,class:"mr-2"},Y={key:0,class:"text-red-500 text-xs mt-1"},Z={key:0,class:"text-red-500 text-xs mt-1"},ee={key:0,class:"text-red-500 text-xs mt-1"},te={key:0,class:"text-red-500 text-xs mt-1"},se={key:0,class:"text-red-500 text-xs mt-1"},oe={key:0,class:"text-red-500 text-xs mt-1"},ne={class:"flex justify-end space-x-3 mt-4"},re=["disabled"],le={key:0,class:"animate-spin mr-2"},ae={__name:"ClientFormModal",props:{client:Object},emits:["close"],setup(u,{emit:p}){const k=u,C=p,_=G(),{addClient:m,updateClient:U,clearErrors:h}=_,{errors:n,loading:x}=L(_),e=S({id:null,nom:"",adresse:"",code_postal:"",ville:"",pays:"",siren:""});O(()=>{e.value=k.client?{...k.client}:{id:null,nom:"",adresse:"",code_postal:"",ville:"",pays:"",siren:""}});const r=async()=>{(e.value.id?await U(e.value):await m(e.value))&&l()},l=()=>{h("validationErrors"),C("close")};return(y,t)=>{var w,c,q,M,N,A,B,D,T,z,F,I;return d(),a("div",H,[s("div",{onClick:P(l,["self"]),class:"fixed inset-0"}),s("div",J,[s("div",K,[s("h2",Q,[e.value.id?(d(),a("span",W,"✏️")):(d(),a("span",X,"➕")),R(" "+f(e.value.id?"Éditer le client":"Ajouter un client"),1)]),s("button",{onClick:l,class:"text-gray-500 hover:text-gray-700 transition"},"✖️")]),s("form",{onSubmit:P(r,["prevent"]),class:"mt-4 space-y-4"},[s("div",null,[t[6]||(t[6]=s("label",{for:"nom",class:"block text-sm font-medium text-gray-700"},"Nom du client *",-1)),b(s("input",{ref:"firstInput",type:"text",id:"nom","onUpdate:modelValue":t[0]||(t[0]=i=>e.value.nom=i),class:E(["w-full border p-2 rounded focus:outline-none focus:ring-2 focus:ring-indigo-500",{"border-red-500":(w=o(n).validationErrors)==null?void 0:w.nom}])},null,2),[[g,e.value.nom]]),(c=o(n).validationErrors)!=null&&c.nom?(d(),a("p",Y,f(o(n).validationErrors.nom.join(", ")),1)):v("",!0)]),s("div",null,[t[7]||(t[7]=s("label",{for:"adresse",class:"block text-sm font-medium text-gray-700"},"Adresse",-1)),b(s("input",{type:"text",id:"adresse","onUpdate:modelValue":t[1]||(t[1]=i=>e.value.adresse=i),class:E(["w-full border p-2 rounded focus:outline-none focus:ring-2 focus:ring-indigo-500",{"border-red-500":(q=o(n).validationErrors)==null?void 0:q.adresse}])},null,2),[[g,e.value.adresse]]),(M=o(n).validationErrors)!=null&&M.adresse?(d(),a("p",Z,f(o(n).validationErrors.adresse.join(", ")),1)):v("",!0)]),s("div",null,[t[8]||(t[8]=s("label",{for:"code_postal",class:"block text-sm font-medium text-gray-700"},"Code Postal",-1)),b(s("input",{type:"text",id:"code_postal","onUpdate:modelValue":t[2]||(t[2]=i=>e.value.code_postal=i),class:E(["w-full border p-2 rounded focus:outline-none focus:ring-2 focus:ring-indigo-500",{"border-red-500":(N=o(n).validationErrors)==null?void 0:N.code_postal}])},null,2),[[g,e.value.code_postal]]),(A=o(n).validationErrors)!=null&&A.code_postal?(d(),a("p",ee,f(o(n).validationErrors.code_postal.join(", ")),1)):v("",!0)]),s("div",null,[t[9]||(t[9]=s("label",{for:"ville",class:"block text-sm font-medium text-gray-700"},"Ville",-1)),b(s("input",{type:"text",id:"ville","onUpdate:modelValue":t[3]||(t[3]=i=>e.value.ville=i),class:E(["w-full border p-2 rounded focus:outline-none focus:ring-2 focus:ring-indigo-500",{"border-red-500":(B=o(n).validationErrors)==null?void 0:B.ville}])},null,2),[[g,e.value.ville]]),(D=o(n).validationErrors)!=null&&D.ville?(d(),a("p",te,f(o(n).validationErrors.ville.join(", ")),1)):v("",!0)]),s("div",null,[t[10]||(t[10]=s("label",{for:"pays",class:"block text-sm font-medium text-gray-700"},"Pays",-1)),b(s("input",{type:"text",id:"pays","onUpdate:modelValue":t[4]||(t[4]=i=>e.value.pays=i),class:E(["w-full border p-2 rounded focus:outline-none focus:ring-2 focus:ring-indigo-500",{"border-red-500":(T=o(n).validationErrors)==null?void 0:T.pays}])},null,2),[[g,e.value.pays]]),(z=o(n).validationErrors)!=null&&z.pays?(d(),a("p",se,f(o(n).validationErrors.pays.join(", ")),1)):v("",!0)]),s("div",null,[t[11]||(t[11]=s("label",{for:"siren",class:"block text-sm font-medium text-gray-700"},"SIREN",-1)),b(s("input",{type:"text",id:"siren","onUpdate:modelValue":t[5]||(t[5]=i=>e.value.siren=i),class:E(["w-full border p-2 rounded focus:outline-none focus:ring-2 focus:ring-indigo-500",{"border-red-500":(F=o(n).validationErrors)==null?void 0:F.siren}])},null,2),[[g,e.value.siren]]),(I=o(n).validationErrors)!=null&&I.siren?(d(),a("p",oe,f(o(n).validationErrors.siren.join(", ")),1)):v("",!0)]),s("div",ne,[s("button",{type:"button",onClick:l,class:"px-4 py-2 border border-gray-300 rounded hover:bg-gray-100 transition"}," Annuler "),s("button",{type:"submit",class:"px-4 py-2 bg-indigo-600 text-white rounded flex items-center hover:bg-indigo-700 transition",disabled:e.value.id?o(x).update:o(x).add},[(e.value.id?o(x).update:o(x).add)?(d(),a("span",le,"⏳")):v("",!0),R(" "+f(e.value.id?"Mettre à jour":"Ajouter"),1)],8,re)])],32)])])}}};export{ae as _,G as u};
