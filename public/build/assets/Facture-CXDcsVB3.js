import{s as M,o as D,c as o,a as n,u as a,b as e,t as x,F as j,r as S,d as k,e as w,f as g,n as P,g as i,j as V,w as E,k as B,v as N,m as I,h as L}from"./app-Jvx3VFZV.js";import{a as $,b as T,_ as O}from"./FactureFormModal-BGhsIUF8.js";/* empty css            */import"./prestations-B3L3b5PY.js";const z={class:"mt-6"},R={key:0,class:"flex justify-center my-6"},U={key:1,class:"flex justify-center my-6 bg-red-500 text-white px-6 py-3 rounded-lg shadow-lg"},q={class:"text-lg font-medium ml-2"},G={key:2,class:"flex justify-center my-6 bg-gray-800 px-6 py-4 rounded-lg shadow-lg"},H={key:3,class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6 mt-8"},J={__name:"FacturesList",setup(s){const u=$(),{fetchInvoices:y}=u,{invoices:l,errors:m,loading:b}=M(u);return D(()=>{y()}),(p,d)=>(n(),o("div",z,[a(b).fetch?(n(),o("div",R,d[0]||(d[0]=[e("div",{class:"animate-spin inline-block w-6 h-6 border-4 border-white border-t-transparent rounded-full"},null,-1),e("p",{class:"text-white text-lg font-medium ml-2"},"Chargement des factures...",-1)]))):a(m).fetch?(n(),o("div",U,[d[1]||(d[1]=e("span",{class:"text-xl"},"❌",-1)),e("p",q,x(a(m).fetch),1)])):a(l).length===0?(n(),o("div",G,d[2]||(d[2]=[e("p",{class:"text-gray-300 text-lg"},"📭 Aucune facture trouvée.",-1)]))):(n(),o("div",H,[(n(!0),o(j,null,S(a(l),v=>(n(),k(a(ye),{invoice:v,key:v.id},null,8,["invoice"]))),128))]))]))}},K={class:"bg-gray-800 p-6 rounded-lg shadow-lg flex flex-col space-y-4"},Q={class:"flex justify-between items-center border-b pb-3"},W={class:"text-xl font-semibold text-white flex items-center gap-2"},X={class:"bg-gray-900 p-4 rounded-md space-y-2"},Y={class:"text-gray-300 text-lg"},Z={class:"font-semibold text-white"},ee={class:"text-gray-300 text-lg"},te={class:"font-semibold text-white"},se={class:"bg-gray-900 p-4 rounded-lg flex flex-col space-y-3"},ne={class:"text-lg font-semibold text-white flex items-center gap-2"},ie={class:"bg-gray-900 p-4 rounded-lg flex flex-col space-y-3"},oe={class:"text-gray-300 text-md flex items-center"},le={class:"ml-2 font-semibold text-white"},ae={class:"text-gray-300 text-md flex items-center"},re={class:"ml-2 font-semibold text-white"},de={class:"text-gray-300 text-md flex items-center"},ce={class:"ml-2 font-semibold text-white"},ue={class:"text-gray-300 text-md flex items-center"},me={class:"ml-2 font-semibold text-white"},xe={class:"bg-gray-900 p-4 rounded-md"},fe={class:"text-gray-300 text-lg"},ve={class:"flex flex-wrap justify-center gap-3 mt-4"},pe=["disabled"],ge={key:0,class:"animate-spin border-4 border-white border-t-transparent rounded-full w-4 h-4"},ye={__name:"FactureListItem",props:{invoice:Object},setup(s){const u=$(),{paid:y}=u,{loading:l}=M(u),m=w(!1),b=w(!1),p=w(!1);function d(f){switch(f){case"en_attente_paiement":return"bg-red-500 text-white px-3 py-1 rounded-full text-xs";case"payé":return"bg-green-500 text-white px-3 py-1 rounded-full text-xs";default:return"bg-gray-500 text-white px-3 py-1 rounded-full text-xs"}}function v(f){switch(f){case"en_attente_envoi":return"En attente d'envoi";case"en_attente_paiement":return"En attente de paiement";case"payé":return"Payé";default:return f}}async function c(f){await y(f.id)}return(f,t)=>(n(),o(j,null,[e("div",K,[e("div",Q,[e("h2",W," 🧾 Facture #"+x(s.invoice.id),1),e("span",{class:P(d(s.invoice.statut))},x(v(s.invoice.statut)),3)]),e("div",X,[e("p",Y,[t[6]||(t[6]=i(" ⏱️ ")),e("span",Z,x(s.invoice.heures_total)+" h",1)]),e("p",ee,[t[7]||(t[7]=i(" 💶 ")),e("span",te,x(s.invoice.montant_total)+" €",1)])]),e("div",se,[e("h3",ne,[t[8]||(t[8]=e("span",{class:"text-indigo-300 text-xl"},"👤",-1)),i(" "+x(s.invoice.prestations[0].client.nom),1)])]),e("div",ie,[t[13]||(t[13]=e("h3",{class:"text-lg font-semibold text-white flex items-center gap-2"},[e("span",{class:"text-indigo-300 text-xl"},"💼"),i(" Prestations ")],-1)),(n(!0),o(j,null,S(s.invoice.prestations,r=>(n(),o("div",{key:r.id,class:"bg-gray-800 p-3 rounded-md grid grid-cols-2"},[e("p",oe,[t[9]||(t[9]=i(" 📆 ")),e("span",le,x(a(V)(r.date)),1)]),e("p",ae,[t[10]||(t[10]=i(" 💵 ")),e("span",re,x(r.heures*r.taux_horaire.taux)+" €",1)]),e("p",de,[t[11]||(t[11]=i(" 💰 ")),e("span",ce,x(r.taux_horaire.taux)+" € / h",1)]),e("p",ue,[t[12]||(t[12]=i(" ⏳ ")),e("span",me,x(r.heures)+" h",1)])]))),128))]),e("div",xe,[e("p",fe,[t[14]||(t[14]=i(" ✅ ")),t[15]||(t[15]=e("span",{class:"font-semibold text-white"},"Payée le :",-1)),i(" "+x(s.invoice.paye_le!==null?s.invoice.paye_le:"Non payée"),1)])]),e("div",ve,[e("button",{onClick:t[0]||(t[0]=r=>b.value=!0),class:"btn-action bg-gray-600"}," 📄 Voir "),s.invoice.statut==="en_attente_paiement"?(n(),o("button",{key:0,onClick:t[1]||(t[1]=r=>m.value=!0),class:"btn-action bg-red-500"}," 🗑️ Supprimer ")):g("",!0),s.invoice.statut==="en_attente_paiement"?(n(),o("button",{key:1,onClick:t[2]||(t[2]=r=>c(s.invoice)),disabled:a(l).paid,class:"btn-action bg-green-500 disabled:opacity-50"},[a(l).paid?(n(),o("span",ge)):g("",!0),t[16]||(t[16]=i(" ✅ Payé "))],8,pe)):g("",!0)])]),b.value?(n(),k(a(T),{key:0,invoice:s.invoice,onClose:t[3]||(t[3]=r=>b.value=!1)},null,8,["invoice"])):g("",!0),m.value?(n(),k(a(ke),{key:1,invoice:s.invoice,onClose:t[4]||(t[4]=r=>m.value=!1)},null,8,["invoice"])):g("",!0),p.value?(n(),k(a(Fe),{key:2,invoice:s.invoice,onClose:t[5]||(t[5]=r=>p.value=!1)},null,8,["invoice"])):g("",!0)],64))}},be={key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-md flex items-center justify-center z-50"},he={class:"bg-white p-6 rounded-lg shadow-lg w-[30rem] animate-fade-in transform transition-transform scale-95"},_e={class:"text-gray-700 mt-3"},we={class:"text-gray-900"},ke={__name:"FactureDeleteModal",props:{invoice:Object},emits:["close"],setup(s,{emit:u}){const y=s,l=u,m=$(),{deleteInvoice:b}=m;function p(){l("close")}async function d(){await b(y.invoice.id),p()}return(v,c)=>s.invoice?(n(),o("div",be,[e("div",{onClick:E(p,["self"]),class:"absolute inset-0"}),e("div",he,[c[3]||(c[3]=e("div",{class:"flex items-center space-x-3"},[e("span",{class:"text-red-600 text-2xl"},"⚠️"),e("h2",{class:"text-lg font-semibold text-red-600"},"Confirmation de suppression")],-1)),e("p",_e,[c[0]||(c[0]=i(" Êtes-vous sûr de vouloir supprimer la facture ")),e("strong",we,"#"+x(s.invoice.id),1),c[1]||(c[1]=i(" ? "))]),c[4]||(c[4]=e("p",{class:"text-sm text-gray-500 mt-2"},[i("Cette action est "),e("span",{class:"font-semibold text-red-500"},"irréversible"),i(".")],-1)),e("div",{class:"flex justify-end mt-6 space-x-3"},[e("button",{onClick:p,class:"px-4 py-2 text-gray-700 border border-gray-300 rounded-md hover:bg-gray-100 transition"}," Annuler "),e("button",{onClick:d,class:"px-4 py-2 bg-red-500 text-white rounded-md hover:bg-red-600 transition flex items-center"},c[2]||(c[2]=[e("span",{class:"mr-2"},"🗑️",-1),i(" Supprimer ")]))])])])):g("",!0)}},$e={class:"fixed inset-0 flex items-center justify-center bg-black/50 backdrop-blur-md"},Ce={class:"bg-white p-6 rounded-xl shadow-xl w-[90%] sm:w-96 transform transition-all animate-fade-in"},je={key:0,class:"error-message"},Ee={class:"flex justify-end space-x-3 mt-4"},Me=["disabled"],Ae={key:0,class:"animate-spin mr-2"},Fe={__name:"FactureMailModal",props:{invoice:Object},emits:["close"],setup(s,{emit:u}){var t,r,A,F;const y=s,l=u,m=$(),{sendEmail:b}=m,{loading:p}=M(m),d=w(((F=(A=(r=(t=y.invoice)==null?void 0:t.reservation)==null?void 0:r.renter)==null?void 0:A.tutor)==null?void 0:F.email)||""),v=w({}),c=async()=>{v.value={};const C=d.value.split(",").map(_=>_.trim()).filter(_=>_.length>0);if(C.filter(_=>!I(_)).length>0){v.value.emailAddress="Adresse(s) email invalide(s)";return}try{await b(y.invoice.id,C),f()}catch(_){console.error("Erreur lors de l'envoi de la facture par email :",_)}},f=()=>{v.value={},l("close")};return(C,h)=>(n(),o("div",$e,[e("div",{onClick:E(f,["self"]),class:"fixed inset-0"}),e("div",Ce,[e("div",{class:"flex items-center justify-between border-b pb-2"},[h[1]||(h[1]=e("h2",{class:"text-xl font-semibold text-gray-800 flex items-center"}," 📩 Envoyer la facture par email ",-1)),e("button",{onClick:f,class:"text-gray-500 hover:text-gray-700 transition"},"✖️")]),e("form",{onSubmit:E(c,["prevent"]),class:"mt-4 space-y-4"},[e("div",null,[h[2]||(h[2]=e("label",{for:"email",class:"block text-sm font-medium text-gray-700"},[i(" Adresse(s) email(s) "),e("span",{class:"text-gray-500"},'(séparées par ",")')],-1)),B(e("input",{type:"text","onUpdate:modelValue":h[0]||(h[0]=_=>d.value=_),class:"w-full border p-2 rounded focus:outline-none focus:ring-2 focus:ring-indigo-500",placeholder:"ex: user1@example.com; user2@example.com"},null,512),[[N,d.value]]),v.value.emailAddress?(n(),o("p",je,x(v.value.emailAddress),1)):g("",!0)]),e("div",Ee,[e("button",{type:"button",onClick:f,class:"btn-secondary"},"Annuler"),e("button",{type:"submit",class:"btn-primary flex items-center",disabled:a(p).sendEmail},[a(p).sendEmail?(n(),o("span",Ae,"⏳")):g("",!0),h[3]||(h[3]=i(" Envoyer "))],8,Me)])],32)])]))}},Se={class:"bg-gray-900"},De={class:"mx-auto max-w-7xl"},Pe={class:"bg-gray-900 py-10"},Ve={class:"px-4 sm:px-6 lg:px-8"},Be={class:"sm:flex sm:items-center"},Ne={class:"mt-4"},ze={__name:"Facture",setup(s){const u=w(!1);return(y,l)=>(n(),o("div",Se,[e("div",De,[e("div",Pe,[e("div",Ve,[e("div",Be,[l[2]||(l[2]=e("div",{class:"sm:flex-auto"},[e("h1",{class:"text-base font-semibold leading-6 text-white"},"Factures"),e("p",{class:"mt-2 text-sm text-gray-300"}," Liste de toutes les factures. ")],-1)),e("div",Ne,[e("button",{onClick:l[0]||(l[0]=m=>u.value=!0),class:"bg-indigo-500 text-white px-4 py-2 rounded-md"},"Ajouter une facture")])]),L(a(J)),u.value?(n(),k(a(O),{key:0,onClose:l[1]||(l[1]=m=>u.value=!1)})):g("",!0)])])])]))}};export{ze as default};
