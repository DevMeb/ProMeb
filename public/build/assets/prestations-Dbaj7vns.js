import{p as b,e as o,i as d,E as j,x as f,q as v,G as w}from"./app-D1nYlzh5.js";const M=b("prestations",()=>{const s=o([]),n=o({}),p=o({}),i=o({month_year:"",client_id:"",taux_horaire_id:""});function g(e){i.value=e}const x=d(()=>Object.values(i.value).some(e=>e!=="")),l=o([]);j([s,i],()=>{l.value=s.value.filter(e=>{const{month_year:t,client_id:a,taux_horaire_id:r}=i.value;return!(t&&w(e.date).format("YYYY-MM")!==t||a&&e.client_id!==a||r&&e.taux_horaire_id!==r)})},{deep:!0,immediate:!0});const P=d(()=>l.value.length),S=d(()=>l.value.reduce((e,t)=>e+t.heures,0)),q=d(()=>s.value.filter(e=>(console.log("PRESTATION",e),console.log(e.facture_id),e.facture_id==null)));function m(e){e?n.value[e]=null:n.value={}}function _(e,t){p.value[e]=t}async function c({operation:e,request:t,onSuccess:a}){var r,h,y;m(e),_(e,!0);try{const u=await t();return a&&a(u),u}catch(u){((r=u.response)==null?void 0:r.status)===422?n.value.validationErrors=u.response.data.errors:(n.value[e]=((y=(h=u.response)==null?void 0:h.data)==null?void 0:y.message)||"Une erreur est survenue.",f("error",n.value[e]))}finally{_(e,!1)}}async function E(){return c({operation:"fetch",request:()=>v.get("/api/prestations"),onSuccess:e=>{s.value=e.data.prestations}})}async function Y(e){return c({operation:"add",request:()=>v.post("/api/prestations",e),onSuccess:t=>{s.value.push(t.data.prestation),f("success",t.data.message)}})}async function A(e){return c({operation:"update",request:()=>v.put(`/api/prestations/${e.id}`,e),onSuccess:t=>{const a=s.value.findIndex(r=>r.id===e.id);a!==-1&&(s.value[a]=t.data.prestation),f("success",t.data.message)}})}async function F(e){return c({operation:"delete",request:()=>v.delete(`/api/prestations/${e}`),onSuccess:t=>{s.value=s.value.filter(a=>a.id!==e),f("success",t.data.message)}})}return{prestations:s,errors:n,loading:p,activeFilters:i,updateFilters:g,filteredPrestations:l,isAnyFilterActive:x,fetchPrestations:E,addPrestation:Y,updatePrestation:A,deletePrestation:F,clearErrors:m,prestationCount:P,totalHours:S,unbilledPrestations:q}});export{M as u};
